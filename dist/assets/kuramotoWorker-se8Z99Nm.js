var Ba=Object.defineProperty;var Ka=(D,E,K)=>E in D?Ba(D,E,{enumerable:!0,configurable:!0,writable:!0,value:K}):D[E]=K;var w=(D,E,K)=>Ka(D,typeof E!="symbol"?E+"":E,K);(function(){"use strict";const D=["rim","surface","phase","volume"],E=(a,e)=>({width:a,height:e,texels:a*e}),K={rim:0,surface:1,phase:2,volume:3},je={planar:0,interleaved:1},Ge={float32:0,uint8:1},qe={static:0,dynamic:1,workerStream:2},Qe={gradientX:0,gradientY:1,magnitude:2,baseR:3,baseG:4,baseB:5,baseA:6,phaseGradX:7,phaseGradY:8,phaseVorticity:9,phaseCoherence:10,volumePhase:11,volumeDepth:12,volumeIntensity:13},q=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/[-\s]+/g,"_").toUpperCase(),Je=()=>Object.entries(Qe).map(([a,e])=>`#define FIELD_SEMANTIC_${q(a)} ${e}`).join(`
`),We=()=>D.map(a=>`#define FIELD_KIND_${q(a)} ${K[a]}`).join(`
`),ea=()=>Object.entries(je).map(([a,e])=>`#define FIELD_STORAGE_${q(a)} ${e}`).join(`
`),aa=()=>Object.entries(Ge).map(([a,e])=>`#define FIELD_FORMAT_${q(a)} ${e}`).join(`
`),ta=()=>Object.entries(qe).map(([a,e])=>`#define FIELD_LIFETIME_${q(a)} ${e}`).join(`
`);`${We()}${ea()}${aa()}${ta()}${Je()}`;const ra=(a,e)=>{if(!a)throw new Error(e)},Q=(a,e,t,r,n)=>{ra(a.length===e,`[fields:${r}] ${t} length ${a.length} != expected ${e} (${n})`)},Fe=(a,e)=>{const t=a.resolution.texels;Q(a.gradX,t,"gradX","phase",e),Q(a.gradY,t,"gradY","phase",e),Q(a.vort,t,"vort","phase",e),Q(a.coh,t,"coh","phase",e),Q(a.amp,t,"amp","phase",e)},Se=2,Pe=Math.PI*2,na=a=>{let e=a;for(;e>Math.PI;)e-=Pe;for(;e<=-Math.PI;)e+=Pe;return e};let sa=0;class be{constructor(e,t){w(this,"id");w(this,"resolution");w(this,"buffer");w(this,"view");w(this,"real");w(this,"imag");w(this,"metadata");w(this,"inUse",!1);this.id=sa++,this.resolution=E(e.width,e.height);const r=e.texels,n=r*2*Float32Array.BYTES_PER_ELEMENT;this.buffer=t??new ArrayBuffer(n),this.view=new Float32Array(this.buffer),this.real=this.view.subarray(0,r),this.imag=this.view.subarray(r,r*2),this.metadata={schemaVersion:Se,solver:"dispatcher",solverInstanceId:"unassigned",frameId:-1,timestamp:0,dt:0,wavelengthNm:550,pixelPitchMeters:1e-6,space:"screen",phaseReference:"wrapped"}}markAcquired(e){this.metadata=e,this.inUse=!0}markReleased(){this.inUse=!1}getMeta(){return this.metadata}updateMeta(e){this.metadata={...this.metadata,...e,phaseOrigin:e.phaseOrigin??this.metadata.phaseOrigin,userTags:e.userTags??this.metadata.userTags}}isInUse(){return this.inUse}getPhase(e){return Math.atan2(this.imag[e],this.real[e])}applyPhaseRotation(e){const t=Math.cos(e),r=Math.sin(e);for(let n=0;n<this.real.length;n++){const s=this.real[n],l=this.imag[n];this.real[n]=s*t-l*r,this.imag[n]=s*r+l*t}}}const ca=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();class la{constructor(e){w(this,"solver");w(this,"solverInstanceId");w(this,"resolution");w(this,"capacity");w(this,"pool",[]);w(this,"live",new Set);w(this,"nextFrameId");w(this,"hooks",new Set);w(this,"defaults");this.solver=e.solver,this.solverInstanceId=e.solverInstanceId??`${e.solver}-default`,this.resolution=E(e.resolution.width,e.resolution.height),this.capacity=Math.max(1,e.capacity??4),this.nextFrameId=e.initialFrameId??0,this.defaults={dt:e.defaultDt??0,wavelengthNm:e.defaultWavelengthNm??550,pixelPitchMeters:e.defaultPixelPitchMeters??1e-6,space:e.defaultSpace??"screen"}}acquireFrame(e){let t=this.pool.pop();t||(t=new be(this.resolution));const r=this.makeMetadata(e);return t.markAcquired(r),this.live.add(t),t}releaseFrame(e){if(!this.live.has(e))throw new Error("[opticalField] attempt to release frame not owned by manager");this.live.delete(e),e.markReleased(),this.pool.length<this.capacity&&this.pool.push(e)}alignPhase(e,t){if(!this.live.has(e))throw new Error("[opticalField] cannot align phase for unmanaged frame");const{anchorIndex:r,referencePhase:n}=t;if(r<0||r>=e.real.length)throw new Error(`[opticalField] anchor index ${r} out of bounds for ${e.real.length} samples`);const s=t.tolerance??1e-6,l=e.getPhase(r);if(!Number.isFinite(l))return 0;const h=na(n-l);Math.abs(h)>s&&e.applyPhaseRotation(h),e.updateMeta({phaseReference:"aligned",phaseOrigin:{anchorIndex:r,referencePhase:n,appliedDelta:h}});for(const c of this.hooks)c({field:e,request:t,phaseDelta:h});return h}stampFrame(e,t){if(!this.live.has(e))throw new Error("[opticalField] cannot stamp metadata for unmanaged frame");const r=e.getMeta(),n=this.allocateFrameId(t==null?void 0:t.frameId),s={...this.makeMetadata(t,r),frameId:n,timestamp:(t==null?void 0:t.timestamp)??ca(),dt:(t==null?void 0:t.dt)??r.dt??this.defaults.dt,wavelengthNm:(t==null?void 0:t.wavelengthNm)??r.wavelengthNm??this.defaults.wavelengthNm,pixelPitchMeters:(t==null?void 0:t.pixelPitchMeters)??r.pixelPitchMeters??this.defaults.pixelPitchMeters,space:(t==null?void 0:t.space)??r.space??this.defaults.space,phaseReference:(t==null?void 0:t.phaseReference)??"wrapped",phaseOrigin:void 0,notes:(t==null?void 0:t.notes)??r.notes,userTags:t!=null&&t.userTags?{...t.userTags}:r.userTags?{...r.userTags}:void 0};return e.markAcquired(s),s}registerPhaseHook(e){return this.hooks.add(e),()=>{this.hooks.delete(e)}}getResolution(){return this.resolution}getLatestFrameId(){return this.nextFrameId-1}allocateFrameId(e){if(e!=null)return e>=this.nextFrameId&&(this.nextFrameId=e+1),e;const t=this.nextFrameId;return this.nextFrameId+=1,t}makeMetadata(e,t){const r=(e==null?void 0:e.userTags)??(t==null?void 0:t.userTags);return{schemaVersion:Se,solver:this.solver,solverInstanceId:this.solverInstanceId,frameId:(e==null?void 0:e.frameId)??(t==null?void 0:t.frameId)??-1,timestamp:(e==null?void 0:e.timestamp)??(t==null?void 0:t.timestamp)??0,dt:(e==null?void 0:e.dt)??(t==null?void 0:t.dt)??this.defaults.dt,wavelengthNm:(e==null?void 0:e.wavelengthNm)??(t==null?void 0:t.wavelengthNm)??this.defaults.wavelengthNm,pixelPitchMeters:(e==null?void 0:e.pixelPitchMeters)??(t==null?void 0:t.pixelPitchMeters)??this.defaults.pixelPitchMeters,space:(e==null?void 0:e.space)??(t==null?void 0:t.space)??this.defaults.space,phaseReference:(e==null?void 0:e.phaseReference)??(t==null?void 0:t.phaseReference)??"wrapped",phaseOrigin:t==null?void 0:t.phaseOrigin,notes:(e==null?void 0:e.notes)??(t==null?void 0:t.notes),userTags:r?{...r}:void 0}}}const ia=(a,e,t)=>Number.isNaN(a)?e:Number.isFinite(a)?a<e?e:a>t?t:a:a>0?t:e,Ee={gain:1,k0:.08,Q:2.2,anisotropy:.6,chirality:.4,transparency:.2},oa={gain:{min:0,max:6},k0:{min:.01,max:.45},Q:{min:.5,max:10},anisotropy:{min:0,max:2},chirality:{min:0,max:2.5},transparency:{min:0,max:1}},z=(a,e)=>{const t=oa[a],r=Ee[a];return e==null?r:ia(e,t.min,t.max)},Te=a=>({gain:z("gain",a==null?void 0:a.gain),k0:z("k0",a==null?void 0:a.k0),Q:z("Q",a==null?void 0:a.Q),anisotropy:z("anisotropy",a==null?void 0:a.anisotropy),chirality:z("chirality",a==null?void 0:a.chirality),transparency:z("transparency",a==null?void 0:a.transparency)}),ha=a=>Te(a),A=a=>Te({...a}),b=Object.freeze((a=>({gain:a.gain,k0:a.k0,Q:a.Q,anisotropy:a.anisotropy,chirality:a.chirality,transparency:a.transparency}))(Ee)),J=(a,e,t)=>Math.max(e,Math.min(t,a)),Ne=a=>J(a,0,1),H=a=>{let e=a;for(;e>Math.PI;)e-=2*Math.PI;for(;e<=-Math.PI;)e+=2*Math.PI;return e},_=(a,e,t,r)=>{const n=(a%t+t)%t;return(e%r+r)%r*t+n},_e=a=>Ne(a??0),re=a=>({...a,phaseOrigin:a.phaseOrigin?{...a.phaseOrigin}:void 0,userTags:a.userTags?{...a.userTags}:void 0}),ma=(a,e,t)=>{const r=E(a,e),n=r.texels,s=new Float32Array(n*3);return{resolution:r,exposureSeconds:0,foveaPx:[Math.floor(a/2),Math.floor(e/2)],buffer:s,L:s.subarray(0,n),M:s.subarray(n,n*2),S:s.subarray(n*2,n*3),opticalMeta:re(t),kernel:A(b),kernelVersion:0}},da=()=>({frameId:-1,timestamp:0,dt:0,kernelVersion:0,kernel:A(b),orderParameter:{magnitude:0,phase:0,real:0,imag:0,sampleCount:0},interference:{mean:0,variance:0,max:0}}),ve=(a,e)=>{const t=_e(e==null?void 0:e.dmt),r=_e(e==null?void 0:e.arousal),n=b.anisotropy,s=b.chirality,l=b.transparency,c=1+.45*J(a.anisotropy-n,-1,1),i=Math.max(0,c+.25*t+.2*r),f=Math.max(0,a.gain*(1+.35*t+.25*r)),u=1+.4*(a.chirality-s),g=Math.max(0,u+.2*t+.15*r),d=Math.max(0,1+.55*(a.transparency-l)+.25*t);return{flux:i,amplitude:f,phase:g,transparency:d}},ua=(a,e)=>((!a.theta||a.theta.length!==e)&&(a.theta=new Float32Array(e)),a.theta),fa=(a,e)=>{const t=b.k0,r=t>0?(e.k0-t)/t:0,n=J(r,-.95,3);return a.phase*(1+.5*n)},ga=(a,e)=>{const t=J(e.chirality-b.chirality,-2.5,2.5);return a.phase*(1+.35*t)},Ia=(a,e,t)=>{const{fluxX:r=0,fluxY:n=0}=e;if(r===0&&n===0)return;const{width:s,height:l}=a.resolution,h=a.real,c=a.imag,i=s>1?1/(s-1):0,f=l>1?1/(l-1):0,u=t.flux;for(let g=0;g<l;g++){const d=l>1?g*f*2-1:0;for(let I=0;I<s;I++){const k=s>1?I*i*2-1:0,o=g*s+I,m=u*(r*k+n*d);if(m===0)continue;const F=Math.cos(m),T=Math.sin(m),y=h[o],S=c[o];h[o]=y*F-S*T,c[o]=y*T+S*F}}},ya=(a,e,t,r)=>{const{width:n,height:s}=a.resolution,l=a.real,h=a.imag,{fluxX:c=0,fluxY:i=0}=e,f=Math.cos(c),u=Math.sin(c),g=Math.cos(i),d=Math.sin(i),I=-u,k=-d,o=c!==0,m=i!==0,F=.2*r.flux,T=b.anisotropy,y=J(t.anisotropy-T,-1,1),S=1+.5*y,L=1-.5*y;return{coupling(v,x,$){const ce=_(v-1,x,n,s),le=_(v+1,x,n,s),ie=_(v,x-1,n,s),ee=_(v,x+1,n,s);let Y=l[ce],C=h[ce],X=l[le],U=h[le],V=l[ie],B=h[ie],M=l[ee],Z=h[ee];if(o&&v===n-1){const P=X,N=U;X=P*f-N*u,U=P*u+N*f}if(o&&v===0){const P=Y,N=C;Y=P*f-N*I,C=P*I+N*f}if(m&&x===s-1){const P=M,N=Z;M=P*g-N*d,Z=P*d+N*g}if(m&&x===0){const P=V,N=B;V=P*g-N*k,B=P*k+N*g}const ae=l[$],te=h[$],oe=ae+S*(Y+X)+L*(V+M),he=te+S*(C+U)+L*(B+Z);return{Hr:F*oe,Hi:F*he}}}},Ma=(a,e,t)=>{const{amp:r,coh:n}=e,{real:s,imag:l}=a,h=t.transparency;for(let c=0;c<s.length;c++){const i=Math.hypot(s[c],l[c])*t.amplitude;r[c]=i,n[c]=Ne(i*h)}},ka=(a,e,t,r,n)=>{const{gradX:s,gradY:l,vort:h}=e,{width:c,height:i}=a.resolution,f=a.real,u=a.imag,g=f.length,d=ua(n,g);for(let o=0;o<g;o++)d[o]=Math.atan2(u[o],f[o]);const I=fa(t,r),k=ga(t,r);for(let o=0;o<i;o++)for(let m=0;m<c;m++){const F=o*c+m,T=_(m-1,o,c,i),y=_(m+1,o,c,i),S=_(m,o-1,c,i),L=_(m,o+1,c,i);s[F]=.5*I*H(d[y]-d[T]),l[F]=.5*I*H(d[L]-d[S])}for(let o=0;o<i;o++)for(let m=0;m<c;m++){const F=o*c+m,T=_(m+1,o,c,i),y=_(m+1,o+1,c,i),S=_(m,o+1,c,i),L=H(d[T]-d[F]),v=H(d[y]-d[T]),x=H(d[S]-d[y]),$=H(d[F]-d[S]);h[F]=k*(L+v+x+$)/(2*Math.PI)}},xa=(a,e)=>{switch(a){case"flux":e.params&&Ia(e.field,e.params,e.gains);break;case"amplitude":e.derived&&Ma(e.field,e.derived,e.gains);break;case"phase":e.derived&&ka(e.field,e.derived,e.gains,e.kernel,e.scratch);break}},wa=(a,e)=>{const{field:t}=e,{branches:r,recombine:n="sum"}=a;if(!r.length)return;const s=t.resolution,l=s.texels,h=new Float32Array(l),c=new Float32Array(l);let i=0,f=0;for(const I of r){const k=I.weight??1;i+=k,f+=k*k;const o=new be(s);o.real.set(t.real),o.imag.set(t.imag);const m={field:o,derived:void 0,params:e.params,kernel:e.kernel,gains:e.gains,scratch:{}};ge(I.steps,m);const F=o.real,T=o.imag;for(let y=0;y<l;y++)h[y]+=F[y]*k,c[y]+=T[y]*k}let u=1;switch(n){case"average":i!==0&&(u=1/i);break;case"energy":f!==0&&(u=1/Math.sqrt(f));break;case"sum":default:u=1;break}const g=t.real,d=t.imag;for(let I=0;I<l;I++)g[I]=h[I]*u,d[I]=c[I]*u},ge=(a,e)=>{for(const t of a)t.kind==="operator"?xa(t.operator,e):t.kind==="beamSplit"&&wa(t,e)},pa=[{kind:"operator",operator:"amplitude"},{kind:"operator",operator:"phase"}],Le=(a,e,t)=>{const r=E(a,e),n=new la({solver:"kuramoto",resolution:r,initialFrameId:0}),s=n.acquireFrame(),l=da(),h=s.getMeta(),c=ma(a,e,h);return{width:a,height:e,manager:n,field:s,Zr:s.real,Zi:s.imag,telemetry:l,irradiance:c}},Fa=5,Sa=(a,e)=>a*e*Fa*Float32Array.BYTES_PER_ELEMENT,Oe=(a,e,t)=>{const r=e*t,n=new Float32Array(a),s=n.subarray(0,r),l=n.subarray(r,r*2),h=n.subarray(r*2,r*3),c=n.subarray(r*3,r*4),i=n.subarray(r*4,r*5);return{kind:"phase",resolution:E(e,t),gradX:s,gradY:l,vort:h,coh:c,amp:i}},Ie=(a,e,t)=>{const{width:r,height:n,Zr:s,Zi:l}=a;for(let f=0;f<n;f++)for(let u=0;u<r;u++){const g=2*Math.PI*e*u/r,d=f*r+u;s[d]=Math.cos(g),l[d]=Math.sin(g)}const h=a.field.getMeta(),c=a.telemetry;c.frameId=-1,c.timestamp=0,c.dt=0,c.kernelVersion=0,c.kernel=A(b),c.orderParameter.magnitude=0,c.orderParameter.phase=0,c.orderParameter.real=0,c.orderParameter.imag=0,c.orderParameter.sampleCount=0,c.interference.mean=0,c.interference.variance=0,c.interference.max=0;const i=a.irradiance;i.exposureSeconds=0,i.foveaPx=[Math.floor(r/2),Math.floor(n/2)],i.L.fill(0),i.M.fill(0),i.S.fill(0),i.kernelVersion=0,i.kernel=A(b),i.opticalMeta=re(h)},Ae=(a,e,t,r,n,s)=>{const{width:l,height:h,Zr:c,Zi:i}=a,{alphaKur:f,gammaKur:u,omega0:g,K0:d,epsKur:I}=e,k=(s==null?void 0:s.kernel)??b,o=ve(k,s==null?void 0:s.controls),m=s==null?void 0:s.telemetry,F=(m==null?void 0:m.captureIrradiance)??!0;s!=null&&s.schedule&&ge(s.schedule,{field:a.field,derived:void 0,params:e,kernel:k,gains:o,scratch:{}});const T=ya(a.field,e,k,o),y=Math.cos(f),S=Math.sin(f),L=.5*d*o.phase,v=Math.sqrt(Math.max(t*I,0)),x=a.irradiance,$=l*h,ce=x.L,le=x.M,ie=x.S;m!=null&&m.foveaPx&&(x.foveaPx=[m.foveaPx[0],m.foveaPx[1]]);let ee=0,Y=0,C=0,X=0,U=0,V=0;for(let me=0;me<h;me++)for(let de=0;de<l;de++){const R=me*l+de,{Hr:we,Hi:pe}=T.coupling(de,me,R),j=c[R],G=i[R],Be=j*j-G*G,Ke=2*j*G,Aa=y*we+S*pe,Ca=-S*we+y*pe,ze=we,He=-pe,Ye=Be*ze-Ke*He,Xe=Be*He+Ke*ze,Ra=y*Ye-S*Xe,Da=S*Ye+y*Xe,$a=-u*j-g*G+L*(Aa-Ra),Va=-u*G+g*j+L*(Ca-Da),ue=j+t*$a+v*r(),fe=G+t*Va+v*r();c[R]=ue,i[R]=fe;const O=ue*ue+fe*fe;X+=O,U+=O*O,O>V&&(V=O);const Ue=Math.sqrt(O);if(Ue>1e-12){const Ze=1/Ue;ee+=ue*Ze,Y+=fe*Ze,C+=1}F&&(ce[R]=O,le[R]=O,ie[R]=O)}const B=a.manager.stampFrame(a.field,{dt:t,timestamp:n}),M=a.telemetry,Z=C>0?1/C:0,ae=ee*Z,te=Y*Z;M.frameId=B.frameId,M.timestamp=B.timestamp,M.dt=t;const oe=(m==null?void 0:m.kernelVersion)??M.kernelVersion;M.kernelVersion=oe,M.kernel=A(k),M.orderParameter.real=ae,M.orderParameter.imag=te,M.orderParameter.magnitude=Math.hypot(ae,te),M.orderParameter.phase=Math.atan2(te,ae),M.orderParameter.sampleCount=C;const he=$>0?$:1,P=X/he,N=Math.max(0,U/he-P*P);return M.interference.mean=P,M.interference.variance=N,M.interference.max=V,x.exposureSeconds=F?t:0,x.kernelVersion=oe,x.kernel=A(k),x.opticalMeta=re(B),{telemetry:M,irradiance:x}},Pa=a=>({telemetry:{frameId:a.telemetry.frameId,timestamp:a.telemetry.timestamp,dt:a.telemetry.dt,kernelVersion:a.telemetry.kernelVersion,kernel:A(a.telemetry.kernel),orderParameter:{magnitude:a.telemetry.orderParameter.magnitude,phase:a.telemetry.orderParameter.phase,real:a.telemetry.orderParameter.real,imag:a.telemetry.orderParameter.imag,sampleCount:a.telemetry.orderParameter.sampleCount},interference:{mean:a.telemetry.interference.mean,variance:a.telemetry.interference.variance,max:a.telemetry.interference.max}},irradiance:{exposureSeconds:a.irradiance.exposureSeconds,foveaPx:[a.irradiance.foveaPx[0],a.irradiance.foveaPx[1]],kernelVersion:a.irradiance.kernelVersion,kernel:A(a.irradiance.kernel),opticalMeta:re(a.irradiance.opticalMeta)}}),Ce=(a,e,t)=>{const r=(t==null?void 0:t.kernel)??b,n=ve(r,t==null?void 0:t.controls),s=(t==null?void 0:t.schedule)??pa,l={field:a.field,derived:e,params:t==null?void 0:t.params,kernel:r,gains:n,scratch:{}};ge(s,l)},ba=a=>{let e=a>>>0;return()=>{e+=1831565813;let t=Math.imul(e^e>>>15,1|e);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}},ye=a=>{const e=a==null?Math.random:ba(a);let t=null;return()=>{if(t!=null){const c=t;return t=null,c}let r=0,n=0;for(;r===0;)r=e();for(;n===0;)n=e();const s=Math.sqrt(-2*Math.log(r)),l=s*Math.cos(2*Math.PI*n);return t=s*Math.sin(2*Math.PI*n),l}},Me=self;let p=null,ne=null,Re=ye(),se=[],De=0,$e=0,ke=null,xe=0;const W=(a,e)=>{e?Me.postMessage(a,e):Me.postMessage(a)},Ea=(a,e)=>{(!p||p.width!==a||p.height!==e)&&(p=Le(a,e))},Ve=a=>{Re=ye(a)},Ta=()=>se.shift()??null,Na=a=>{se.push(a)},_a=a=>{if(!p||!ne)return;const e=Ta();if(!e){W({kind:"log",message:"[kur-worker] dropping frame: buffer pool empty"});return}const t=ke??b;Ae(p,ne,a.dt,Re,a.timestamp,{kernel:t,telemetry:{kernelVersion:xe}});const r=p.field.getMeta(),n=Oe(e,p.width,p.height);Fe(n,"worker:tick"),Ce(p,n,{kernel:t});const s=Pa(p);W({kind:"frame",buffer:e,timestamp:a.timestamp,frameId:r.frameId,queueDepth:se.length,kernelVersion:xe,meta:r,instrumentation:s},[e])},va=a=>{De=a.width,$e=a.height,ne={...a.params},Ea(De,$e),Ve(a.seed),se=[...a.buffers],p&&(Ie(p,a.qInit),W({kind:"ready",width:p.width,height:p.height}))},La=a=>{p&&(Ve(a.seed),Ie(p,a.qInit))},Oa=a=>{const e=Le(a.width,a.height),t={...a.params},r=ye(a.seed);Ie(e,a.qInit);const n=Sa(a.width,a.height),s=[],l=ke??b;for(let h=0;h<a.frameCount;h++){Ae(e,t,a.dt,r,a.dt*(h+1),{kernel:l});const c=new ArrayBuffer(n),i=Oe(c,a.width,a.height);Fe(i,"worker:simulate"),Ce(e,i,{kernel:l}),s.push(c)}W({kind:"simulateResult",buffers:s,width:a.width,height:a.height,frameCount:a.frameCount},s)};Me.onmessage=a=>{const e=a.data;switch(e.kind){case"init":va(e);break;case"tick":_a(e);break;case"updateParams":ne={...e.params};break;case"kernelSpec":ke=ha(e.spec),xe=e.version;break;case"reset":La(e);break;case"returnBuffer":Na(e.buffer);break;case"simulate":Oa(e);break;default:W({kind:"log",message:`[kur-worker] unhandled message ${e==null?void 0:e.kind}`});break}}})();
